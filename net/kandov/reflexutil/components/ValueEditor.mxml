<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
	dataChange="dataChangeHandler()">
	
	<mx:Script>
		<![CDATA[
			import mx.core.IFlexDisplayObject;
			import mx.events.CloseEvent;
			import mx.managers.PopUpManager;
			import mx.states.State;
			import net.kandov.reflexutil.types.PropertyInfo;
			
			public function get value():Object {
				return propertyInfo.value;
			}
			
			public function set value(value:Object):void {
				try {
					propertyInfo.component[propertyInfo.name] = value;
				} catch (error:Error) {
				}
			}
			
			[Bindable(event="dataChange")]
			private function get propertyInfo():PropertyInfo {
				return PropertyInfo(data);
			}
			
			private function dataChangeHandler():void {
				if (propertyInfo) {
					if (propertyInfo.access == "readwrite") {
						for each (var state:State in states) {
							if (state.name == propertyInfo.type) {
								currentState = state.name;
								break;
							}
						}
					} else {
						currentState = propertyInfo.access;
					}
				}
			}
			
			private function imgDescribeClickHandler():void {
				var descritor:ValueDescriptor = new ValueDescriptor();
				descritor.data = propertyInfo;
				descritor.addEventListener(CloseEvent.CLOSE, popUpCloseHandler, false, 0, true);
				PopUpManager.addPopUp(descritor, this);
				PopUpManager.centerPopUp(descritor);
			}
			
			private function popUpCloseHandler(event:CloseEvent):void {
				var popUp:IFlexDisplayObject = IFlexDisplayObject(event.currentTarget);
				popUp.removeEventListener(CloseEvent.CLOSE, popUpCloseHandler);
				PopUpManager.removePopUp(popUp);
			}
		]]>
	</mx:Script>
	
	<mx:Style>
		.stepperSensitivityButton {
			corner-radius:0;
			border-style:none;
			font-size:8;
			padding-left:0;
			padding-right:0;
		}
	</mx:Style>
	
	<mx:states>
		<mx:State name="readonly">
			<mx:AddChild relativeTo="{canvasValueHolder}" position="firstChild">
				<mx:Label width="{canvasValueHolder.width}" text="{propertyInfo.value}"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="writeonly">
			<mx:AddChild relativeTo="{canvasValueHolder}" position="firstChild">
				<mx:Label width="{canvasValueHolder.width}" text="[no read access]" color="#ff0000"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="boolean">
			<mx:AddChild relativeTo="{canvasValueHolder}" position="firstChild">
				<mx:HBox horizontalGap="2">
					<mx:CheckBox id="chkBooleanValue" selected="{propertyInfo.value}"
						change="value = chkBooleanValue.selected"/>
					<mx:Label text="{propertyInfo.value}"/>
				</mx:HBox>
			</mx:AddChild>
		</mx:State>
		<mx:State name="number">
			<mx:AddChild relativeTo="{canvasValueHolder}" position="firstChild">
				<mx:HBox width="100%" horizontalGap="0">
					<mx:NumericStepper id="stpNumberValue" width="100%" value="{Number(propertyInfo.value)}"
						minimum="-2147483648" maximum="2147483648"
						change="value = stpNumberValue.value"/>
					<mx:VBox height="100%" verticalGap="0">
						<mx:Button label="1" width="22" height="11" styleName="stepperSensitivityButton"
							click="stpNumberValue.stepSize = 1" enabled="{stpNumberValue.stepSize != 1}"
							toolTip="Set step sensitivity to 1"/>
						<mx:Button label="0.1" width="22" height="11" styleName="stepperSensitivityButton"
							click="stpNumberValue.stepSize = 0.1" enabled="{stpNumberValue.stepSize != 0.1}"
							toolTip="Set step sensitivity to 0.1"/>
					</mx:VBox>
				</mx:HBox>
			</mx:AddChild>
		</mx:State>
		<mx:State name="int">
			<mx:AddChild relativeTo="{canvasValueHolder}" position="firstChild">
				<mx:NumericStepper id="stpIntValue" width="100%" value="{int(propertyInfo.value)}"
					minimum="-2147483648" maximum="2147483648"
					change="value = stpIntValue.value"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="object">
			<mx:AddChild relativeTo="{canvasValueHolder}" position="firstChild">
				<mx:Label width="{canvasValueHolder.width}" text="{propertyInfo.value}"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="string">
			<mx:AddChild relativeTo="{canvasValueHolder}" position="firstChild">
				<mx:TextInput id="txtStringValue" width="100%" text="{propertyInfo.value}"
					change="value = txtStringValue.text"/>
			</mx:AddChild>
		</mx:State>
		<!-- TODO: after adding styles, implement these types (determine them in ClassUtil) -->
		<!--<mx:State name="Color">
		</mx:State>
		<mx:State name="FontName">
		</mx:State>
		<mx:State name="List">
		</mx:State>-->
	</mx:states>
	
	<mx:HBox id="boxEditor" width="100%" height="22" verticalAlign="middle" horizontalGap="2">
		<mx:Image id="imgBindable" source="@Embed('../assets/b.png')" toolTip="Bindable"
			visible="{propertyInfo.bindable}"/>
		<mx:Image id="imgDescribe" source="@Embed('../assets/magnifier.png')" toolTip="Watch"
			buttonMode="true" click="imgDescribeClickHandler()" visible="{propertyInfo.access != 'writeonly'}"/>
		<mx:Canvas id="canvasValueHolder" width="100%"/>
	</mx:HBox>
	
</mx:Canvas>